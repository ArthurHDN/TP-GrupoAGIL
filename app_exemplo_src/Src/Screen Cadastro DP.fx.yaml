"'Screen Cadastro DP' As screen.'phoneLayout_FluidGridWithHeaderPageLayout_ver3.0'":
    LoadingSpinnerColor: =RGBA(100, 118, 132, 1)
    OnVisible: |-
        =Set(varAppBarAction,0);
        Set(varActionAppBarButton,false);
        Set(varActionPopupButton,0);
        Set(varShowPopUp,false);

    AppBar_3 As AppBar:
        Action2: =false
        Action3: =false
        Action4: =false
        ButtonIcon: =Icon.Mail
        ButtonText: ="Enviar Email"
        ButtonWidth: =155
        Icon1: =Icon.Home
        Logo: =vetta
        ShowButton: =If((varPermissionsDP || varPermissionsAdmin || varPermissionsDev),true,false)
        Title: ="Cadastro DP"
        ZIndex: =1

    cnvForm1_1 As fluidGrid.fluidGridWithBlankCard:
        BorderStyle: =BorderStyle.None
        BorderThickness: =0
        ContentLanguage: =
        Height: =658
        NumberOfColumns: =3
        Width: =Parent.Width
        Y: =110
        ZIndex: =2

        dtcEmailFuncionario As dataCard:
            BorderColor: =RGBA(0, 0, 0, 1)
            BorderStyle: =BorderStyle.Solid
            BorderThickness: =0
            DisplayMode: =If((varPermissionsDP || varPermissionsAdmin || varPermissionsDev),Edit,View)
            Fill: =RGBA(0, 0, 0, 0)
            Height: =100
            Width: =Parent.Width
            X: =0
            Y: =1
            ZIndex: =1

            txtEmailFuncionario As text:
                BorderColor: =LightGray
                Color: =RGBA(0, 0, 0, 1)
                Default: =varCurrentItem.'2 Email Funcionario'
                DelayOutput: =true
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                FocusedBorderThickness: =1
                Font: =Font.'Segoe UI'
                HintText: =""
                HoverBorderColor: =Self.BorderColor
                HoverColor: =RGBA(0, 0, 0, 1)
                HoverFill: =LightGray
                PaddingLeft: =10
                PaddingRight: =10
                PressedBorderColor: =Self.BorderColor
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Reset: =true
                Size: =11
                Width: =1300
                X: =25
                Y: =45
                ZIndex: =1

            lblEmailFuncionario As label:
                BorderColor: =RGBA(32, 54, 71, 1)
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Size: =13
                Text: ="Email do funcionário *"
                Width: =259
                X: =20
                Y: =5
                ZIndex: =2

        dtcSectionDisparoEmail As dataCard.blankCard:
            BorderColor: =RGBA(0, 0, 0, 1)
            BorderStyle: =BorderStyle.Solid
            DisplayMode: =If((varPermissionsDP || varPermissionsAdmin || varPermissionsDev),Edit,View)
            Fill: =RGBA(0, 0, 0, 0)
            Height: =77
            Width: =1365
            X: =0
            Y: =0
            ZIndex: =2

            lblSectionDisparoEmail As label:
                BorderColor: =RGBA(32, 54, 71, 1)
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =34
                OnSelect: |-
                    =If(varStep3DadosPessoais,UpdateContext({varStep3DadosPessoais:false}),UpdateContext({varStep3DadosPessoais:true}))
                Size: =20
                Text: ="Disparo de E-mail"
                Width: =334
                X: =20
                Y: =21
                ZIndex: =1

            shpAppTitleDivider_8 As rectangle:
                BorderColor: =RGBA(32, 54, 71, 1)
                Fill: =RGBA(204, 204, 204, 1)
                Height: =0.5
                Width: =1316
                X: =20
                Y: =61
                ZIndex: =2

    tmrCadastroDPBarAction As timer:
        Duration: =1
        Fill: =RGBA(56, 96, 178, 1)
        HoverColor: =RGBA(255, 255, 255, 1)
        HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
        OnTimerEnd: |-
            =Switch(
                varAppBarAction,
                1,
                    Navigate('Screen Home')
                    
            );
            
            Set(varAppBarAction,0);
        Reset: =varAppBarAction=0 || App.ActiveScreen.Name<>'Screen Cadastro DP'.Name
        Start: =varAppBarAction<>0 && App.ActiveScreen.Name='Screen Cadastro DP'.Name
        Visible: =false
        X: =54
        Y: =728
        ZIndex: =5

    tmrCadastroDPButtonAction As timer:
        Duration: =1
        Fill: =RGBA(56, 96, 178, 1)
        HoverColor: =RGBA(255, 255, 255, 1)
        HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
        OnTimerEnd: |-
            =If(varCurrentItem.EtapaAtual>2 && (varPermissionsAdmin || varPermissionsDev), Set(varShowPopUp,true),
                    If(
                        IsBlank(txtEmailFuncionario.Text),
            
                        Notify("Existem campos obrigatórios a serem preenchidos!",Error),
                        //If(1=0;
                        If(Text('Admissão-EmailparaFuncionário'.Run(txtEmailFuncionario.Text,varCurrentItem.OData__x0031_NomeColaborador,Text(varCurrentItem.OData__x0031_Dataadmissao,ShortDate)).error)="True",
            
                            Notify("Erro ao enviar email, verifique email inserido!",Error),
                        
                            Concurrent(
                                Patch(colAdmissao,LookUp(colAdmissao,Title=varCurrentItem.Title),
                                    {
                                        EtapaAtual: 3,
                                        OData__x0032_Responsavel:User().Email,
                                        OData__x0032_Timestamp:Now(),
                                        OData__x0032_EmailFuncionario:txtEmailFuncionario.Text
                                    }
                                ),
                                Patch('[DPE_001] Admissão',LookUp('[DPE_001] Admissão',Title=varCurrentItem.Title),
                                    {
                                        EtapaAtual: 3,
                                        OData__x0032_Responsavel: User().Email,
                                        OData__x0032_Timestamp: Now(),
                                        OData__x0032_EmailFuncionario:txtEmailFuncionario.Text
                                    }
                                )
                            );
                            Notify("Seu email foi enviado para " & txtEmailFuncionario.Text,Success);
                            'Admissão-NotificarTeams'.Run(varCurrentItem.Title,"Pendente");
                            Navigate('Screen Home',None)
                        )
                    )
                  
            );
            
            Set(varActionAppBarButton,false);
        Reset: =!varActionAppBarButton || App.ActiveScreen.Name<>'Screen Cadastro DP'.Name
        Start: =varActionAppBarButton && App.ActiveScreen.Name='Screen Cadastro DP'.Name
        Visible: =false
        X: =94
        Y: =728
        ZIndex: =6

    tmrCadastroDPPopupAction As timer:
        Duration: =1
        Fill: =RGBA(56, 96, 178, 1)
        HoverColor: =RGBA(255, 255, 255, 1)
        HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
        OnTimerEnd: |
            =If(
                IsBlank(txtEmailFuncionario.Text),
            
                Notify("Existem campos obrigatórios a serem preenchidos!",Error),
                //If(1=0;
                If(Text('Admissão-EmailparaFuncionário'.Run(txtEmailFuncionario.Text,varCurrentItem.OData__x0031_NomeColaborador,Text(varCurrentItem.OData__x0031_Dataadmissao,ShortDate)).error)="True",
            
                    Notify("Erro ao enviar email, verifique email inserido!",Error),
                
                    Concurrent(
                        Patch(colAdmissao,LookUp(colAdmissao,Title=varCurrentItem.Title),
                            {
                                EtapaAtual: If(varActionPopupButton=1,3,varCurrentItem.EtapaAtual),
                                OData__x0032_Responsavel:User().Email,
                                OData__x0032_Timestamp:Now(),
                                OData__x0032_EmailFuncionario:txtEmailFuncionario.Text
                            }
                        ),
                        Patch('[DPE_001] Admissão',LookUp('[DPE_001] Admissão',Title=varCurrentItem.Title),
                            {
                                EtapaAtual: If(varActionPopupButton=1,3,varCurrentItem.EtapaAtual),
                                OData__x0032_Responsavel: User().Email,
                                OData__x0032_Timestamp: Now(),
                                OData__x0032_EmailFuncionario:txtEmailFuncionario.Text
                            }
                        )
                    );
                    Notify("Seu email foi enviado para " & txtEmailFuncionario.Text,Success);
                    If(varActionPopupButton=1,'Admissão-NotificarTeams'.Run(varCurrentItem.Title,"Pendente"));
                    Navigate('Screen Home',None)
                )
            );
            
            Set(varActionPopupButton,0);
            Set(varShowPopUp,false);
                
        Reset: =varActionPopupButton=0 || App.ActiveScreen.Name<>'Screen Cadastro DP'.Name
        Start: =varActionPopupButton<>0 && App.ActiveScreen.Name='Screen Cadastro DP'.Name
        Visible: =false
        X: =256
        Y: =728
        ZIndex: =7

    Popup_2 As Popup:
        NegativeText: ="Manter etapa"
        NegativeX: =Popup_2.PositiveX-Popup_2.NegativeWidth-20
        PositiveFill: =ColorSuccess.Color
        PositiveText: ="Voltar etapa"
        ThemeColor: =ColorSuccess.Color
        TitleSubText: ="Este processo já se encontra em uma etapa posterior. Deseja confirmar as alterações voltando a esta etapa ou mantendo a etapa atual?"
        TitleText: ="⚠️ Atenção"
        Visible: =varShowPopUp
        ZIndex: =8

